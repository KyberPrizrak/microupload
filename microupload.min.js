/**
 * microupload.js
 *
 * Copyright (C) 2020 Konstantin A Chugunnyj (KyberPrizrak)
 *
 * LICENSE:
 *
 * This file is part of microupload.
 *
 * microupload is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * microupload is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with microupload. If not, see <http://www.gnu.org/licenses/>.
 *
 * @author KyberPrizrak (www.kyberprizrak.ru)
 * @version 0.1.7 - 2020.05.04 14:52:00 GMT+3
 */

(function(){function k(a,c){try{if("string"===typeof a)for(var e=document.querySelectorAll(a),b=0;b<e.length;b++)k(e[b],c);else{var h=m(c);a.onchange=function(){n(a.files,h)}}}catch(d){}}function m(a){"object"!==typeof a&&(a={});return{url:a.url?a.url:"/upload.php",data:a.data,name:a.name?a.name:"file",c:a.container,l:a.preview,b:0<a.preview_max_width?a.preview_max_width:100,a:0<a.preview_max_height?a.preview_max_height:100,cancelable:a.cancelable,j:a.cancel_text?a.cancel_text:"&times;",f:a.extensions?
a.extensions:"*",g:0<=a.max_file_size?a.max_file_size:0,onerror:a.onerror,h:a.onbeforesubmit,onprogress:a.onprogress,oncomplete:a.oncomplete,i:a.ontrycancel}}function n(a,c){if(a)for(var e=0;e<a.length;e++)p(a[e],c)}function p(a,c){function e(b){if(c.onerror)c.onerror(b,a,h);d&&(d.className="microupload_item microupload_item_error")}var b=a.name.split(".");b=b[b.length-1].toLowerCase();if("*"!==c.f&&0>("|"+c.f.split(",").join("|").toLowerCase()+"|").indexOf("|"+b+"|"))e("extension");else if(0<c.g&&
a.size>c.g)e("maxsize");else{window.microupload_filenum||(window.microupload_filenum=0);var h="microupload_"+ ++window.microupload_filenum+"_"+Math.random().toString().substr(2,6);if(c.c&&(b=c.c,"string"===typeof b&&(b=document.querySelector(b)),b)){var d=document.createElement("div");d.id=h;d.className="microupload_item";b.appendChild(d);if(c.l){var l=document.createElement("div");l.className="microupload_preview microupload_preview_empty";window.FileReader&&(b=new FileReader,b.onload=function(a){var b=
new Image;b.onload=function(){var a=b.width,d=b.height;if(0<a&&0<d){if(a>c.b||d>c.a){var e=c.b/a,f=c.a/d;f>e?(b.width=c.b,b.height=Math.ceil(d*e)):d>c.a&&(b.width=Math.ceil(a*f),b.height=c.a)}l&&(l.className="microupload_preview",b.className="microupload_preview_img",l.appendChild(b))}};b.src=a.target.result},b.readAsDataURL(a));d.appendChild(l)}b=document.createElement("div");b.className="microupload_filename";b.innerText=a.name;d.appendChild(b);b=document.createElement("div");b.className="microupload_progress";
d.appendChild(b);var g=document.createElement("div");g.className="microupload_progress_value";g.style.width="0";g.innerText="0%";b.appendChild(g);c.cancelable&&(b=document.createElement("div"),b.className="microupload_cancel",b.innerHTML=c.j,b.onclick=function(){d&&((c.i?c.i(a,h):1)?(f.abort(),d.parentElement.removeChild(d)):e("ontrycancel"))},b.onselectstart=function(a){a.preventDefault();return!1},d.appendChild(b))}if(c.h&&!c.h(a,h))e("onbeforesubmit");else{b=new FormData;b.append(c.name,a);if(c.data)for(var k in c.data)b.append(k,
c.data[k]);var f=new XMLHttpRequest;f.open("POST",c.url,!0);f.onreadystatechange=function(){4==f.readyState&&(200==f.status?(c.oncomplete?c.oncomplete(a,h,f.responseText):1)?(g&&(g.innerText="100%"),d&&(d.className+=" microupload_item_complete")):e("oncomplete"):e("network"))};f.upload&&(f.upload.onprogress=function(b){if(b.lengthComputable&&(b=b.loaded/b.total*100,g&&(g.style.width=Math.ceil(b)+"%",g.innerText=Math.ceil(b)+"%"),c.onprogress))c.onprogress(a,h,b)},f.upload.onerror=function(){e("network")});
f.send(b)}}}window.microupload=k;window.microupload_addfiles=function(a,c){try{n(a,m(c))}catch(e){}}})();
