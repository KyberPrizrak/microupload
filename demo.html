<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>microupload</title>
    <link rel="stylesheet" href="microupload.css" type="text/css">
    <script src="microupload.js" type="text/javascript"></script>
    <style>

      h1 {
        font-size: 16px;
        margin: 30px 0 0 0;
      }

      textarea {
        margin: 10px 0 0 0;
        width: 400px;
        height: 80px;
      }

      input {
        margin: 10px 0 0 0;
      }

      input[type=submit] {
        margin: 10px 5px 0 0;
        width: 90px;
        height: 30px;
        box-sizing: border-box;
        clear: left;
      }

      .form1_addfile {
        padding: 0;
        margin: 12px 0 0 0;
        box-sizing: border-box;
        width: 24px;
        height: 24px;
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3MjFCRTVFMTEyODMxMUU4QUE3RkQ2ODU2RjAzOTNGNiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3MjFCRTVFMjEyODMxMUU4QUE3RkQ2ODU2RjAzOTNGNiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjcyMUJFNURGMTI4MzExRThBQTdGRDY4NTZGMDM5M0Y2IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjcyMUJFNUUwMTI4MzExRThBQTdGRDY4NTZGMDM5M0Y2Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+39+y/QAAANVJREFUeNpi/P//PwMtARMDjQHNLWAABREMA4E3ED8BCZOJHwOxJ4qZaBY8psBwGH6EbCYjciQzMjLCOIzkBgg0VBiHTyQTY0ErEH+G0hSnIlhEIYOfULHPRMbBf2QzifFBDxB/BeJJ5Hhg0KYiSyDWolYcsACxGRJfDJrbrwAxF6E4IMaCPiD+BMQ6QMwMxLuQ1M2j1IJQIP4HFbsDxFOxFA3x5FqgDsQfiSh7vgCxNi4Lhl9Z9ATZq2RgWJEPCg2sydSTwjrhERB74IyD0UofGwAIMAAOayRAiBwQVQAAAABJRU5ErkJggg==);
        border: 1px solid white;
        vertical-align: bottom;
        display: inline-block;
        overflow: hidden;
        opacity: 0.5;
        vertical-align: top;
        cursor: pointer;
      }

      .form1_addfile:hover {
        opacity: 1;
      }

      .form1_addfile input {
        opacity: 0;
        font-size: 0;
        padding: 0;
        margin: 0;
        border: 0;
        box-sizing: border-box;
        cursor: pointer;
        width: 0;
        height: 0;
      }

      .microupload_preview {
        /**
         * Dirty hack! (hide preview by css) Only for demo.
         * Correctly: microupload(a, {preview: false});
         **/
        display: none;
      }

      #form1_attach,
      #form2_attach {
        overflow: hidden;
        width: 50%;
      }

      /* design2 */

      .design2 .microupload_item .microupload_progress {
        display: inline;
        background: transparent;
        padding: 0 0 0 8px;
        margin: 0;
      }
      
      .design2 .microupload_item .microupload_progress .microupload_progress_value {
        display: inline;
        font-size: 14px;
        font-weight: bold;
        background: transparent;
      }

      /* design3 */

      .design3 .microupload_item .microupload_progress {
        margin: 3px 10px 0 0;
        float: left;
      }
      
      .design3 .microupload_item_complete .microupload_progress {
        display: block;
      }

      /* design4 */
  
      .design4 .microupload_item .microupload_cancel {
        background: transparent;
        width: 16px;
        height: 16px;
        line-height: 16px;
        overflow: hidden;
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAUpJREFUOI2F08tKnEEQBeAvJhqccalONHkCwXiPrpPX8I0EQbxLBH0RdSG49ppRcSND9iLEqODvouvXZhz1QNP06TpVxelqXmIMqzjD/1h1LGO4RfwTqthA8c76jUqzuAt7EXCDmajWgc8YxWx0U2C3OclmXFxi4I0uB9HIOgETWeVS/AO1TNgXcfAdt6EZFZmKaLsUX+MkknzBH1xhPGLmQrMCF3EoHa7hOLiTWAUO0BMxk8Gdwn0cOrKWe3Hk2fl9dGf31eDv2loYBR/xKTu3B1fiQ+wFnOeGSIbVgzvMOik9gang6m3YDnI69m+R5Ai/8DPE/fjaFLslKhfSkAzGxXj4UKKWdTiCu9AMlQHrQTSkd34NI/gre8ISFWk8C2lI5qSnqkpjPoWFrPIOOpuzV7Dm7Y/0gKVW4hxDWJSMu8E/abDmPXv0hEdmmGm8v37G5QAAAABJRU5ErkJggg==);
        font-size: 0;
        border-radius: 0;
        margin: 0 0 -4px 5px;
        opacity: 0.5;

      }

      .design4 .microupload_item .microupload_cancel:hover {
        opacity: 1;
      }

      /* design5 */

      .design5 .microupload_preview {
        display: block;
      }

      /* design6 */

      .design6 .microupload_item {
        display: block;
        width: 100px;
        height: 120px;
        float: left;
        margin: 15px 10px 0 0;
        position: relative;
        overflow: visible;
      }

      .design6 .microupload_item .microupload_filename {
        width: 100px;
        overflow: hidden;
        margin-top: 2px;
        white-space: nowrap;
        text-overflow: ellipsis;
      }

      .design6 .microupload_item .microupload_preview {
        display: block;
        width: 100px;
        height: 100px;
        overflow: hidden;
        text-align: center;
        background: #e6e6e6;
        border-radius: 3px;
        line-height: 100px;
      }

      .design6 .microupload_item .microupload_preview .microupload_preview_img {
        display:inline-block;
        vertical-align:middle;
      }

      .design6 .microupload_item .microupload_cancel {
        position: absolute;
        right: -8px;
        top: -8px;
        z-index: 10;
        width: 24px;
        height: 24px;
        /*background: f0f0f0;*/
        opacity: 0.8;
        font-size: 24px;
        line-height: 24px;
      }

      .design6 .microupload_item .microupload_cancel:hover {
        opacity: 1;
      }
 
      .design6 .microupload_item .microupload_progress {
        width: 100px;
        background: #646464;
        height: 4px;
        margin: 0;
      }
     
      .design6 .microupload_item .microupload_progress .microupload_progress_value {
        height: 4px;
      }

      .design6 .microupload_item_error .microupload_progress {
        background: #ff7777;
      }

      .design6 .microupload_item_error .microupload_progress .microupload_progress_value {
        background: #b00000;
      }

      .design6 .microupload_item_error .microupload_preview {
         background: #ffc5c5;
      }

      .design6 .microupload_item .microupload_preview_empty {
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAASAAAAEgARslrPgAAAW1JREFUWMPtmL9KxEAQhz/l0ErQKo3I4SMoWChYWdmKjeJz2F7pPYfWdqIg+ARW2th7Ua4R5bS6IhY7geXM39m5FeV+MBA2O798O0kmS2Cmf6RFoA+8AFnL6E0DqK8AmSqUpjKTcWYJ5Bs3VS8Uat5yBSU6bQMVA6gVVCygxlAxgRpBxQaqhfoNoByqUHMVSVnDeb72JJqAFHpaA9Wp1jP0lu0AN8BI4hrYNoIvXE1Vpz4ExvzszGPgQOmpBloB3uXcA3Ak8Shjb8ByTKATGR8BiTeeAJ9y7lgD1NGQAgPc9mQADL3xIfAEbAKrSm9Vhcq0DnxJzr6Rpzp5QyqWAZcUv8HRgLZwz1MGXOG2vxaLVCffy7y7CphoQEvevN1QT4tPRwdYk+NnXGMM9QyqUALcSiRGnkHJXW9eN9RT2xh9feCaZH4cpD+1/XidMLKIXGnZRauAzo2qUqQLTVL+syE1rFCK2+AvTHGxM8XVN1152m1mv8q2AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIwLTA1LTAxVDIwOjIyOjIwKzAwOjAwY6zQ9QAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMC0wNS0wMVQyMDoyMjoyMCswMDowMBLxaEkAAAAodEVYdHN2ZzpiYXNlLXVyaQBmaWxlOi8vL3RtcC9tYWdpY2stcWhPNzA1U3eRhX3+AAAAAElFTkSuQmCC);
        background-repeat: no-repeat;
        background-position: center center;
      }

      /* design7 */

      .design7 .microupload_item {
        height: 105px;
      }

      .design7 .microupload_item .microupload_filename {
        display: none;
      }

      .design7 .microupload_item .microupload_progress {
        margin-top: 1px;
      }
 
      .design7 .microupload_item .microupload_progress {
        height: 3px;
      }
     
      .design7 .microupload_item .microupload_progress .microupload_progress_value {
        height: 3px;
      }

      /* design8 */

      .design8 .microupload_item .microupload_filename {
        width: 150px;
        overflow: hidden;
        vertical-align: top;
        white-space: nowrap;
        text-overflow: ellipsis;
      }

      .design8 .microupload_item_complete .microupload_progress {
        display: inline-block;
      }

    </style>
  </head>
  <body>

    <select onchange="document.body.className = this.options[this.selectedIndex].value" autocomplete="off">
      <option value="">standart design</option>
      <option value="design2">no progressbar</option>
      <option value="design3">progressbar align left</option>
      <option value="design4">close as icon</option>
      <option value="design5">primitive preview (only if posible)</option>
      <option value="design6">preview thumbnail</option>
      <option value="design6 design7">preview thumbnail without file name</option>
      <option value="design8">list</option>
    </select>

    <h1>Styled input, cancelable, only images, hidden inputs with success uploaded files:</h1>
    <form class="form1" method="post" action="form.php" target="_blank">
      <textarea id="form1_textarea" name="text1"></textarea>
      <div id="form1_attach"></div>
      <input type="submit" name="submit" value="Send">
      <label class="form1_addfile">
        <input type="file" id="form1_file" accept="image/*" multiple="multiple">
      </label>
    </form>


    <h1>Standart input, any extensions, drag&drop to textarea:</h1>
    <form class="form2" method="post" action="form.php" target="_blank">
      <textarea id="form2_textarea" name="text2"></textarea>
      <div id="form2_attach"></div>
      <input type="file" id="form2_file" multiple="multiple"><br>
      <input type="submit" name="submit" value="Send">
    </form>

    <script>

      /*** form1 sample ***/

      microupload('#form1_file', {
        url: 'upload.php',
        data: {aaa: 'bbb', ccc: 'ddd'},
        container: '#form1_attach',
        extensions: 'jpeg,jpg,bmp,png,gif',
        max_file_size: 15*1024*1024,
        preview: true,
        preview_max_width: 100,
        preview_max_height: 100,
        cancelable: true,
        onerror: function(errorcode, filedata, fileid) {
          console.log(['onerror', errorcode, filedata, fileid]);
          if(errorcode==='maxsize') {
            alert('File ' + filedata.name + ' too large!');
          }
        },
        oncomplete: function mycomplete(file, file_id, responseText) {
          console.log(['oncomplete', file, file_id, responseText]);
          //return (responseText==='[response]ok[/response]');
       
          //добавляем скрытый input, в котором сохраняем то, что вернул сервер (например: id файла).
          var obj = document.getElementById(file_id);
          if(obj)
          {
            var data = responseText;
            if ((data.substr(0, 10) == '[response]') && (data.substr(data.length - 11) == '[/response]') && (data.length > 21)) {
              obj_input = document.createElement('input');
              obj_input.value = data.substr(10, data.length - 21);
              obj_input.setAttribute("type", 'hidden');
              obj_input.setAttribute("name", 'file[]');
              obj.appendChild(obj_input);
              return true;
            }
          }
          return false;
        },
        onbeforesubmit: function mybegin(file, file_id) {
          console.log(['onbegin', file, file_id]);
          return true;
        },
        onprogress: function(file, file_id, percentComplete) {
          console.log(['onprogress', file, file_id, percentComplete]);
        },
        ontrycancel: function(file, file_id) {
          console.log(['ontrycancel', file, file_id]);
          return true;
        },
      });

      /*** form2 sample ***/

      microupload('#form2_file', {
        url: 'upload.php',
        container: '#form2_attach',
        preview: true
      });

      /*** drag & drop sample ***/

      document.getElementById("form2_textarea").addEventListener('drop', function(event) {
        if (event.dataTransfer.files.length) {
          event.preventDefault();
          microupload_addfiles(event.dataTransfer.files, {
            url: 'upload.php',
            container: '#form2_attach',
            preview: true
          });
          this.style.border = '';
        }
      });

      document.getElementById('form2_textarea').addEventListener('dragleave', function(event) {
        this.style.border = '';
      });

      document.getElementById('form2_textarea').addEventListener('dragover', function(event) {
        event.preventDefault();
        this.style.border = '2px solid green';
      });

    </script>
  </body>
</html>
